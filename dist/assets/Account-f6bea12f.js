import{Y as j,Z as M,$ as G,l as R,c as z,y as F,C as H,b as i,d as k,e as d,f as t,w as r,F as T,o as y,N as q,h as Q,z as _,A as C,x as X,n as Y,t as v,g as Z,V as J,M as W,a0 as ee}from"./index-c41c75c2.js";const te={class:"flex flex-column gap-3"},ae={class:"flex flex-wrap gap-2 justify-content-between"},ne={class:"flex gap-2"},oe=["src"],se=d("div",{class:"flex justify-content-center"}," Không tìm thấy kết quả nào ",-1),le={key:1},ie={__name:"Account",setup(re){const L=j(),P=M(),{onGetterListUser:p,onActionGetListUser:u,onActionUpdateMoneyBalanceUser:x,onActionUpdateStatusUser:N}=G(),U=[{name:"Tất cả",code:"ALL"},{name:"Đang hoạt động",code:"ACTIVE"},{name:"Đã khóa",code:"LOCKED"}],e=R({tabIndex:0,body:{pagination:{first:0,rows:5,sort:null},keySearch:""},topUpNumber:null,tableSelection:[]}),V=z(()=>{switch(e.tabIndex){case 0:return p.value.all;case 1:return p.value.active;case 2:return p.value.locked;default:return p.value.all}}),m=l=>e.tableSelection.map(n=>n[l]),g=l=>!m("status").includes(l),D=l=>{switch(l){case"male":return"Nam";case"female":return"Nữ";case"other":return"Khác";default:return""}},I=()=>{e.body.keySearch="",e.tableSelection=[]},S=(l,n)=>{u({tab:l,keySearch:n})},w=(l,n,s,{tab:h,keySearch:b})=>{if(m("status").includes(s==="TOPUP"?"LOCKED":s)){L.error("Vui lòng chỉ chọn dòng dữ liệu có trạng thái: "+l);return}P.require({message:`Bạn muốn ${n} tài khoản?`,header:s==="TOPUP"?"Nhập số tiền cần nạp":"Xác nhận",acceptLabel:s==="TOPUP"?"Nạp tiền":"Đồng ý",acceptClass:s==="LOCKED"?"p-button-danger":"",rejectLabel:"Hủy bỏ",rejectClass:"p-button-outlined",type:s,accept:async()=>{s==="TOPUP"?(await x({ids:m("_id"),moneyNumber:e.topUpNumber})).success&&(await u({tab:h,keySearch:b},!0),ee.emit("isNewData","Dữ liệu mới"),e.topUpNumber=null,e.tableSelection=[]):(await N({ids:m("_id"),status:s})).success&&(e.tableSelection=[],u({tab:h,keySearch:b},!0))}})};return F(()=>e.body.keySearch,l=>{l||u({tab:"ALL",keySearch:""},!0)}),H(()=>{u({tab:"ALL",keySearch:""})}),(l,n)=>{const s=i("Button"),h=i("InputText"),b=i("InputGroup"),c=i("Column"),A=i("StatusComponent"),O=i("DataTable"),E=i("TabPanel"),K=i("TabView"),B=i("InputNumber"),$=i("ConfirmDialog");return y(),k(T,null,[d("div",te,[t(q,{icon:"pi pi-user",title:"Quản lý tài khoản"}),t(K,{activeIndex:e.tabIndex,"onUpdate:activeIndex":n[2]||(n[2]=o=>e.tabIndex=o),onTabChange:I,class:"card"},{default:r(()=>[(y(),k(T,null,Q(U,(o,f)=>t(E,{key:f,header:o.name},{default:r(()=>[t(O,{paginator:!0,selection:e.tableSelection,"onUpdate:selection":n[1]||(n[1]=a=>e.tableSelection=a),value:V.value,first:e.body.pagination.first,rows:e.body.pagination.rows,rowsPerPageOptions:[5,10,15,20],removableSort:!0,paginatorTemplate:" FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Hiển thị {first} - {last} / tổng {totalRecords} dòng"},{header:r(()=>[d("div",ae,[d("div",ne,[_(t(s,{label:"Mở khóa",disabled:g("LOCKED"),onClick:a=>w("đã khóa","mở khóa","ACTIVE",{tab:o.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[C,o.code!=="ACTIVE"]]),_(t(s,{label:"Khóa",class:"p-button-danger",disabled:g("ACTIVE"),onClick:a=>w("hoạt động","khóa","LOCKED",{tab:o.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[C,o.code!=="LOCKED"]]),_(t(s,{label:"Nạp tiền",severity:"secondary",disabled:g("ACTIVE"),onClick:a=>w("hoạt động","nạp tiền","TOPUP",{tab:o.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[C,o.code!=="LOCKED"]])]),t(b,{class:"w-20rem"},{default:r(()=>[t(h,{modelValue:e.body.keySearch,"onUpdate:modelValue":n[0]||(n[0]=a=>e.body.keySearch=a),placeholder:"Tìm theo tên tài khoản",size:"small",class:"w-full",maxLength:"35",onKeypress:X(a=>S(o.code,e.body.keySearch),["enter"])},null,8,["modelValue","onKeypress"]),t(s,{icon:"pi pi-search",class:Y({"p-disabled":!e.body.keySearch}),onClick:a=>S(o.code,e.body.keySearch)},null,8,["class","onClick"])]),_:2},1024)])]),empty:r(()=>[se]),default:r(()=>[t(c,{selectionMode:"multiple",class:"max-w-5rem w-5rem"}),t(c,{field:"email",header:"Tên tài khoản",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),t(c,{field:"avatar",header:"Ảnh đại diện",class:"white-space-nowrap",style:{width:"7rem"}},{body:r(({data:a})=>[d("img",{class:"w-4rem h-4rem object-fit-cover box-shadow-1",src:a.avatar||"/images/avatar.jpg",onerror:"this.onerror=null; this.src='/images/avatar.jpg';"},null,8,oe)]),_:1}),t(c,{field:"fullName",header:"Họ và tên",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),t(c,{field:"phoneNumber",header:"Số điện thoại",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),t(c,{field:"gender",header:"Giới tính",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:r(({data:a})=>[d("span",null,v(D(a.gender)),1)]),_:1}),t(c,{field:"moneyBalance",header:"Số dư",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:r(({data:a})=>[d("span",null,v(Z(J)(a.moneyBalance)),1)]),_:1}),t(c,{field:"status",header:"Trạng thái",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:r(({data:a})=>[t(A,{code:a==null?void 0:a.status},null,8,["code"])]),_:1})]),_:2},1032,["selection","value","first","rows"])]),_:2},1032,["header"])),64))]),_:1},8,["activeIndex"])]),t($,{class:"line-height-3"},{message:r(o=>[o.message.type==="TOPUP"?(y(),W(B,{key:0,modelValue:e.topUpNumber,"onUpdate:modelValue":n[3]||(n[3]=f=>e.topUpNumber=f),class:"w-full",currency:"VND",locale:"vn-VN"},null,8,["modelValue"])):(y(),k("span",le,v(o.message.message),1))]),_:1})],64)}}};export{ie as default};
