import{u as M,ap as U,r as w,c as V,b as D,o as a,d as r,e,F as j,h as E,M as g,g as c,L as k,t as C,n as R,H as A,z as O,K as L,x as z,X as G,a1 as I,A as K,ae as N,aq as q,a as H,C as X,f as W}from"./index-d8252bd5.js";const J={class:"w-full flex flex-column h-full"},P={key:1,class:"flex justify-content-center align-items-center text-center line-height-3"},Q={class:"flex flex-column gap-3 align-items-center"},Y=["src"],Z={class:"text-center line-height-2"},ee={key:0,class:"h-4rem"},te={style:{bottom:"1.8rem","z-index":"999"},class:"fixed left-0 right-0 px-3 bg-white pt-2"},se={style:{"max-width":"50rem"},class:"p-3 border-round-3xl box-shadow-1 flex bg-white m-auto flex-1"},ae=["placeholder","onKeypress"],oe={style:{"padding-left":"0.7rem"},class:"border-left-1 text-400"},le={key:0,class:"pi pi-spin pi-spinner text-900"},ne={__name:"BotVersatileTypeText",props:{botVersatile:{type:Object,required:!0}},setup(B){const _=B,y=M(),{onGetterMessages:t,onActionSendMessage:p}=U(),i=w(""),o=w(!1),m=V(()=>_.botVersatile),d=V(()=>y.params.id),u=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},1)},x=async()=>{if(o.value||t.value.length&&t.value[t.value.length-1].role==="user")return;t.value.push({role:"user",content:i.value,createdAt:G(new Date,!0)}),u(),i.value="",setTimeout(()=>{o.value=!0,u()},1e3);const b=await p({botVersatileId:d.value,messages:t.value.map(({role:h,content:v})=>({role:h,content:v}))});b.success?(t.value.push(b.data.result),I.emit("isNewData","Dữ liệu mới")):t.value=[],o.value=!1,u(),setTimeout(()=>{o.value=!1},300)};return(b,h)=>{var T,$,l;const v=D("UserChat");return a(),r("div",J,[e("div",{style:{"max-width":"52rem"},class:R(["flex flex-1 flex-column gap-3 m-auto w-full pt-3",{"px-3":!c(A),"justify-content-center":!c(t).length}])},[(a(!0),r(j,null,E(c(t),(s,n)=>(a(),g(v,{key:n,name:s.role,content:s.content,role:s.role,createdAt:s.createdAt},null,8,["name","content","role","createdAt"]))),128)),o.value?(a(),g(v,{key:0,role:"assistant"})):k("",!0),c(t).length?k("",!0):(a(),r("div",P,[e("div",Q,[e("img",{class:"w-10rem h-10rem object-fit-cover border-circle",src:(T=m.value)==null?void 0:T.image,onerror:"this.onerror=null; this.src='/images/image-product-default.svg';"},null,8,Y),e("span",Z,C(($=m.value)==null?void 0:$.message),1)])]))],2),c(A)?k("",!0):(a(),r("div",ee)),e("div",te,[e("div",se,[O(e("input",{"onUpdate:modelValue":h[0]||(h[0]=s=>i.value=s),type:"text",class:"w-full border-none outline-none",placeholder:(l=m.value)==null?void 0:l.placeholder,onKeypress:z(x,["enter"])},null,40,ae),[[L,i.value]]),e("div",oe,[o.value?(a(),r("i",le)):(a(),r("i",{key:1,class:R(["pi pi-angle-right text-900 on-click",{"p-disabled":!i.value}]),onClick:x},null,2))])])])])}}},ie={class:"w-full flex flex-column h-full"},re=["src"],ce={class:"fixed",style:{left:"100%"}},ue=["src"],de={class:"flex flex-column gap-2 align-items-center"},pe={class:"flex align-items-center gap-2"},me=e("span",null,"Thêm tệp tin",-1),he={style:{overflow:"hidden"},class:"relative"},ve=e("i",{class:"pi pi-plus-circle on-click text-800"},null,-1),fe={key:0,class:"card-bg-mini inline-flex align-items-center gap-1"},ge={class:"text-700"},_e={key:1,class:"card-bg-mini inline-flex align-items-center gap-1"},ye=e("span",{class:"text-700"},"Chưa có file nào",-1),xe=[ye],be={__name:"BotVersatileTypeAudio",props:{botVersatile:{type:Object,required:!0}},setup(B){const _=B,y=M(),{onGetterMessages:t,onActionSendMessage:p}=U(),i=w(!1);let o=null,m=[];const d=w(null),u=w(""),x=V(()=>_.botVersatile),b=V(()=>y.params.id),h=async l=>{t.value.push({role:"user",content:l});const s=await p({typeResponse:"audio",botVersatileId:b.value,messages:t.value.map(({role:n,content:f})=>({role:n,content:f}))});s.success?(t.value.pop(),s.data.forEach(n=>{t.value.push(n.result)}),console.log(t.value),I.emit("isNewData","Dữ liệu mới")):t.value=[]},v=async l=>{const s=["mp3","wav"];if(!s.T.includes(l.target.files[0].name.split(".").pop().toLowerCase())){u.value=`Chỉ hỗ trợ tệp có đuôi: ${s.join(", ")}`;return}if(+l.target.files[0].size>3145728){u.value="Kích thước tệp không được vượt quá 3MB";return}const n=await N(l.target.files[0],!1);d.value=n,h(n.base64);const f=document.getElementById("inputFile");f.value="",u.value=""},T=async()=>{try{const l=await navigator.mediaDevices.getUserMedia({audio:!0});o=new MediaRecorder(l),m=[],o.ondataavailable=s=>{s.data.size>0&&m.push(s.data)},o.onstop=async()=>{const s=new Blob(m,{type:"audio/WAV"}),n=await q(URL.createObjectURL(s));h(n)},o.start(),i.value=!0}catch(l){console.error("Lỗi khi truy cập microphone: ",l)}},$=()=>{o&&i.value&&(o.stop(),i.value=!1)};return(l,s)=>{var f;const n=D("Button");return a(),r("div",ie,[e("div",{style:{"max-width":"52rem"},class:R(["flex flex-1 flex-column gap-6 m-auto w-full pt-3 align-items-center justify-content-center",{"px-3":!c(A)}])},[e("img",{src:(f=x.value)==null?void 0:f.image,onerror:"this.onerror=null; this.src='/images/image-product-default.svg';",class:"w-13rem h-13rem object-fit-cover"},null,8,re),e("div",ce,[(a(!0),r(j,null,E(c(t),(S,F)=>(a(),r("audio",{key:F,controls:"",autoplay:""},[e("source",{src:S.content,type:"audio/mp3"},null,8,ue)]))),128))]),e("div",de,[e("div",pe,[me,e("div",he,[ve,e("input",{type:"file",id:"inputFile",class:"absolute top-0 right-0 left-0 bottom-0 opacity-0 on-click",accept:".mp3,wav",onChange:v},null,32)])]),O(e("small",{class:"p-error"},C(u.value),513),[[K,u.value]]),d.value?(a(),r("div",fe,[e("span",ge,C(d.value.name),1),e("i",{class:"pi pi-times-circle text-700",onClick:s[0]||(s[0]=S=>d.value=null)})])):(a(),r("div",_e,xe))]),i.value?(a(),g(n,{key:1,label:"Dừng lại",severity:"danger",onClick:$})):(a(),g(n,{key:0,label:"Bắt đầu",onClick:T}))],2)])}}},we={class:"relative flex flex-column h-full"},Ve={__name:"BotVersatile",setup(B){const _=M(),y=H(),{onGetterMessages:t,onGetterBotVersatile:p,onActionGetVersatile:i}=U(),o=V(()=>_.params.id);return X(async()=>{t.value=[],i(o.value)}),(m,d)=>{const u=D("ButtonBack");return a(),r("div",we,[W(u,{onOnBack:d[0]||(d[0]=x=>c(y).push({name:"Application"}))}),c(p).type==="TEXT"?(a(),g(ne,{key:0,botVersatile:c(p)},null,8,["botVersatile"])):k("",!0),c(p).type==="AUDIO"?(a(),g(be,{key:1,botVersatile:c(p)},null,8,["botVersatile"])):k("",!0)])}}};export{Ve as default};
