import{u as D,ap as S,r as k,c as B,b as U,o as s,d as c,e,F as E,h as O,M as g,g as i,L as V,t as C,n as M,H as R,z as j,K as L,x as q,X as z,a1 as I,A as G,ae as K,aq as N,a as X,C as H,f as W}from"./index-ea4656f6.js";const J={class:"w-full flex flex-column h-full"},P={key:1,class:"flex justify-content-center align-items-center text-center line-height-3"},Q={class:"flex flex-column gap-3 align-items-center"},Y=["src"],Z={class:"text-center line-height-2"},ee={key:0,class:"h-4rem"},te={style:{bottom:"1.8rem","z-index":"999"},class:"fixed left-0 right-0 px-3 bg-white pt-2"},se={style:{"max-width":"50rem"},class:"p-3 border-round-3xl box-shadow-1 flex bg-white m-auto flex-1"},ae=["placeholder","onKeypress"],le={style:{"padding-left":"0.7rem"},class:"border-left-1 text-400"},oe={key:0,class:"pi pi-spin pi-spinner text-900"},ne={__name:"BotVersatileTypeText",props:{botVersatile:{type:Object,required:!0},type:{type:String,required:!1,default:"TEXT"}},setup(_){const y=_,x=D(),{onGetterMessages:t,onActionSendMessage:d}=S(),r=k(""),l=k(!1),m=B(()=>y.botVersatile),p=B(()=>x.params.id),u=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},1)},b=async()=>{if(l.value||t.value.length&&t.value[t.value.length-1].role==="user")return;t.value.push({role:"user",content:r.value,createdAt:z(new Date,!0)}),u(),r.value="",setTimeout(()=>{l.value=!0,u()},1e3);const w=await d({botVersatileId:p.value,messages:t.value.map(({role:h,content:v})=>({role:h,content:v}))});w.success?(t.value.push(w.data.result),I.emit("isNewData","Dữ liệu mới")):t.value=[],l.value=!1,u(),setTimeout(()=>{l.value=!1},300)};return(w,h)=>{var T,$,o;const v=U("UserChat");return s(),c("div",J,[e("div",{style:{"max-width":"52rem"},class:M(["flex flex-1 flex-column gap-3 m-auto w-full pt-3",{"px-3":!i(R),"justify-content-center":!i(t).length}])},[(s(!0),c(E,null,O(i(t),(a,n)=>(s(),g(v,{key:n,value:a},null,8,["value"]))),128)),l.value?(s(),g(v,{key:0,type:_.type},null,8,["type"])):V("",!0),i(t).length?V("",!0):(s(),c("div",P,[e("div",Q,[e("img",{class:"w-10rem h-10rem object-fit-cover border-circle",src:(T=m.value)==null?void 0:T.image,onerror:"this.onerror=null; this.src='/images/image-product-default.svg';"},null,8,Y),e("span",Z,C(($=m.value)==null?void 0:$.message),1)])]))],2),i(R)?V("",!0):(s(),c("div",ee)),e("div",te,[e("div",se,[j(e("input",{"onUpdate:modelValue":h[0]||(h[0]=a=>r.value=a),type:"text",class:"w-full border-none outline-none",placeholder:(o=m.value)==null?void 0:o.placeholder,onKeypress:q(b,["enter"])},null,40,ae),[[L,r.value]]),e("div",le,[l.value?(s(),c("i",oe)):(s(),c("i",{key:1,class:M(["pi pi-angle-right text-900 on-click",{"p-disabled":!r.value}]),onClick:b},null,2))])])])])}}},ie={class:"w-full flex flex-column h-full"},re=["src"],ce={class:"fixed",style:{left:"100%"}},ue=["src"],de={class:"flex flex-column gap-2 align-items-center"},pe={class:"flex align-items-center gap-2"},me=e("span",null,"Thêm tệp tin",-1),he={style:{overflow:"hidden"},class:"relative"},ve=e("i",{class:"pi pi-plus-circle on-click text-800"},null,-1),fe={key:0,class:"card-bg-mini inline-flex align-items-center gap-1"},ge={class:"text-700"},_e={key:1,class:"card-bg-mini inline-flex align-items-center gap-1"},ye=e("span",{class:"text-700"},"Chưa có file nào",-1),xe=[ye],be={__name:"BotVersatileTypeAudio",props:{botVersatile:{type:Object,required:!0}},setup(_){const y=_,x=D(),{onGetterMessages:t,onActionSendMessage:d}=S(),r=k(!1);let l=null,m=[];const p=k(null),u=k(""),b=B(()=>y.botVersatile),w=B(()=>x.params.id),h=async o=>{t.value.push({role:"user",content:o});const a=await d({botVersatileId:w.value,messages:t.value.map(({role:n,content:f})=>({role:n,content:f}))});a.success?(t.value.pop(),a.data.forEach(n=>{t.value.push(n.result)}),I.emit("isNewData","Dữ liệu mới")):t.value=[]},v=async o=>{const a=["mp3","wav"];if(!a.T.includes(o.target.files[0].name.split(".").pop().toLowerCase())){u.value=`Chỉ hỗ trợ tệp có đuôi: ${a.join(", ")}`;return}if(+o.target.files[0].size>3145728){u.value="Kích thước tệp không được vượt quá 3MB";return}const n=await K(o.target.files[0],!1);p.value=n,h(n.base64);const f=document.getElementById("inputFile");f.value="",u.value=""},T=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(o),m=[],l.ondataavailable=a=>{a.data.size>0&&m.push(a.data)},l.onstop=async()=>{const a=new Blob(m,{type:"audio/WAV"}),n=await N(URL.createObjectURL(a));h(n)},l.start(),r.value=!0}catch(o){console.error("Lỗi khi truy cập microphone: ",o)}},$=()=>{l&&r.value&&(l.stop(),r.value=!1)};return(o,a)=>{var f;const n=U("Button");return s(),c("div",ie,[e("div",{style:{"max-width":"52rem"},class:M(["flex flex-1 flex-column gap-6 m-auto w-full pt-3 align-items-center justify-content-center",{"px-3":!i(R)}])},[e("img",{src:(f=b.value)==null?void 0:f.image,onerror:"this.onerror=null; this.src='/images/image-product-default.svg';",class:"w-13rem h-13rem object-fit-cover"},null,8,re),e("div",ce,[(s(!0),c(E,null,O(i(t),(A,F)=>(s(),c("audio",{key:F,controls:"",autoplay:""},[e("source",{src:A.content,type:"audio/mp3"},null,8,ue)]))),128))]),e("div",de,[e("div",pe,[me,e("div",he,[ve,e("input",{type:"file",id:"inputFile",class:"absolute top-0 right-0 left-0 bottom-0 opacity-0 on-click",accept:".mp3,wav",onChange:v},null,32)])]),j(e("small",{class:"p-error"},C(u.value),513),[[G,u.value]]),p.value?(s(),c("div",fe,[e("span",ge,C(p.value.name),1),e("i",{class:"pi pi-times-circle text-700",onClick:a[0]||(a[0]=A=>p.value=null)})])):(s(),c("div",_e,xe))]),r.value?(s(),g(n,{key:1,label:"Dừng lại",severity:"danger",onClick:$})):(s(),g(n,{key:0,label:"Bắt đầu",onClick:T}))],2)])}}},we={class:"relative flex flex-column h-full"},Ve={__name:"BotVersatile",setup(_){const y=D(),x=X(),{onGetterMessages:t,onGetterBotVersatile:d,onActionGetVersatile:r}=S(),l=B(()=>y.params.id);return H(async()=>{t.value=[],r(l.value)}),(m,p)=>{const u=U("ButtonBack");return s(),c("div",we,[W(u,{onOnBack:p[0]||(p[0]=b=>i(x).push({name:"Application"}))}),["TEXT","VIDEO"].includes(i(d).type)?(s(),g(ne,{key:0,botVersatile:i(d),type:i(d).type},null,8,["botVersatile","type"])):V("",!0),i(d).type==="AUDIO"?(s(),g(be,{key:1,botVersatile:i(d)},null,8,["botVersatile"])):V("",!0)])}}};export{Ve as default};
