import{u as I,a as L,ab as N,r as x,c as y,C as U,b as k,d as l,f as E,e as t,n as m,g as i,F as S,h as q,M as C,L as f,z as K,K as O,x as z,a0 as D,o as a,H as w}from"./index-14e95bb4.js";const F={class:"relative flex flex-column h-full"},j={key:1,class:"flex justify-content-center align-items-center"},G=t("div",{class:"flex flex-column gap-3 align-items-center"},[t("img",{class:"w-10rem h-10rem",src:"https://cdn-icons-png.flaticon.com/512/1698/1698535.png",alt:"Lỗi ảnh"}),t("span",{class:"text-center line-height-2"}," Tôi đã sẵng sàng trả lời câu hỏi của bạn! ")],-1),H=[G],P={key:0,class:"h-4rem"},J={style:{bottom:"1.8rem","z-index":"9999"},class:"fixed left-0 right-0 px-3 bg-white pt-2"},Q={style:{"max-width":"50rem"},class:"p-3 border-round-3xl box-shadow-1 flex bg-white m-auto flex-1"},W=["onKeypress"],X={style:{"padding-left":"0.7rem"},class:"border-left-1 text-400"},Y={key:0,class:"pi pi-spin pi-spinner text-900"},ee={__name:"VirtualAssistantChat",setup(Z){const v=I(),u=L(),{onGetterMessages:e,onActionChat:b,onActionCheckLinkChat:A,onActionCreateThread:B,onActionGetThread:T}=N(),n=x(""),c=x(!1),d=y(()=>v.query.thread),p=y(()=>v.query.accountId),h=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},1)},R=()=>{e.value=[],u.replace({name:"VirtualAssistant"})},_=async()=>{if(c.value||e.value.length&&e.value[e.value.length-1].role==="user")return;e.value.push({role:"user",content:n.value}),h();let r=n.value;n.value="",setTimeout(()=>{c.value=!0,h()},1e3);const s=await b({threadId:d.value,accountId:p.value,content:r});s.success&&(e.value=s.data,D.emit("isNewData","Dữ liệu mới")),h(),c.value=!1};return U(async()=>{const r=await A(p.value);if(r.success)if(d.value)await T(d.value);else{const s=await B();s.success&&u.replace({name:"VirtualAssistantChat",query:{accountId:p.value,thread:s.data.id}})}else{if(r.statusCode==="ERROR_BALANCE"){u.replace({name:"RequiredTopUp"});return}u.replace({name:"NotFound"});return}h()}),(r,s)=>{const M=k("ButtonBack"),g=k("UserChat");return a(),l("div",F,[E(M,{onOnBack:R}),t("div",{class:m([{"p-disabled":!d.value},"w-full flex flex-column h-full"])},[t("div",{style:{"max-width":"52rem"},class:m([{"px-3":!i(w),"justify-content-center":!i(e).length},"flex flex-1 flex-column gap-3 m-auto w-full pt-3"])},[(a(!0),l(S,null,q(i(e),(o,V)=>(a(),C(g,{key:V,name:o.role,content:o.content,role:o.role,createdAt:o.createdAt},null,8,["name","content","role","createdAt"]))),128)),c.value?(a(),C(g,{key:0,role:"assistant"})):f("",!0),i(e).length?f("",!0):(a(),l("div",j,H))],2),i(w)?f("",!0):(a(),l("div",P)),t("div",J,[t("div",Q,[K(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>n.value=o),type:"text",class:"w-full border-none outline-none",placeholder:"Bạn muốn hỏi gì?",onKeypress:z(_,["enter"])},null,40,W),[[O,n.value]]),t("div",X,[c.value?(a(),l("i",Y)):(a(),l("i",{key:1,class:m(["pi pi-angle-right text-900 on-click",{"p-disabled":!n.value}]),onClick:_},null,2))])])])],2)])}}};export{ee as default};
