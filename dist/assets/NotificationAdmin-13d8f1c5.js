import{a as j,Y as M,Z as U,a1 as G,l as q,c as z,y as F,C as Y,b as l,d as _,e as d,f as n,w as i,F as k,o as C,N as H,h as J,g as S,z as v,A as T,x as Q,n as W,t as x,W as X}from"./index-9d2b4dcd.js";const Z={class:"flex flex-column gap-3"},ee={class:"flex flex-wrap gap-2 justify-content-between"},te={class:"flex gap-2"},ne=["src"],ae=d("div",{class:"flex justify-content-center"}," Không tìm thấy kết quả nào ",-1),ie={__name:"NotificationAdmin",setup(oe){const g=j(),L=M(),N=U(),{onGetterListNotification:u,onActionGetListNotification:p,onActionUpdateStatusNotification:D}=G(),A=[{name:"Tất cả",code:"ALL"},{name:"Mọi người",code:"EVERY_BODY"},{name:"Cá nhân",code:"PERSONAL"},{name:"Đã từng nạp",code:"JOINED"}],t=q({tabIndex:0,body:{pagination:{first:0,rows:5,sort:null},keySearch:""},topUpNumber:null,tableSelection:[]}),I=z(()=>{switch(t.tabIndex){case 0:return u.value.all;case 1:return u.value.everyBody;case 2:return u.value.personal;case 3:return u.value.joined;default:return u.value.all}}),h=a=>t.tableSelection.map(o=>o[a]),y=a=>!h("status").includes(a),P=()=>{t.body.keySearch="",t.tableSelection=[]},f=(a,o)=>{p({tab:a,keySearch:o})},E=({data:a})=>{g.push({name:"NotificationDetailAdmin",params:{id:a._id}})},w=(a,o,c,{tab:m,keySearch:b})=>{if(h("status").includes(c)){L.error("Vui lòng chỉ chọn dòng dữ liệu có trạng thái: "+a);return}N.require({message:`Bạn muốn ${o} thông báo?`,header:"Xác nhận",acceptLabel:"Đồng ý",acceptClass:c==="LOCKED"?"p-button-danger":"",rejectLabel:"Hủy bỏ",rejectClass:"p-button-outlined",accept:async()=>{(await D({ids:h("_id"),status:c})).success&&(t.tableSelection=[],p({tab:m,keySearch:b},!0))}})};return F(()=>t.body.keySearch,a=>{a||p({tab:"ALL",keySearch:""},!0)}),Y(()=>{p({tab:"ALL",keySearch:""})}),(a,o)=>{const c=l("Button"),m=l("InputText"),b=l("InputGroup"),r=l("Column"),V=l("StatusComponent"),R=l("DataTable"),O=l("TabPanel"),B=l("TabView"),K=l("ConfirmDialog");return C(),_(k,null,[d("div",Z,[n(H,{icon:"pi pi-bell",title:"Quản lý thông báo"}),n(B,{activeIndex:t.tabIndex,"onUpdate:activeIndex":o[2]||(o[2]=s=>t.tabIndex=s),onTabChange:P,class:"card"},{default:i(()=>[(C(),_(k,null,J(A,(s,$)=>n(O,{key:$,header:s.name},{default:i(()=>[n(R,{paginator:!0,selection:t.tableSelection,"onUpdate:selection":o[1]||(o[1]=e=>t.tableSelection=e),value:I.value,first:t.body.pagination.first,rows:t.body.pagination.rows,rowsPerPageOptions:[5,10,15,20],removableSort:!0,paginatorTemplate:" FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Hiển thị {first} - {last} / tổng {totalRecords} dòng",onRowDblclick:E},{header:i(()=>[d("div",ee,[d("div",te,[n(c,{label:"Thêm thông báo",severity:"secondary",onClick:e=>S(g).push({name:"NotificationDetailAdmin",params:{id:"create"},query:{sendType:s.code}})},null,8,["onClick"]),v(n(c,{label:"Mở khóa",disabled:y("LOCKED"),onClick:e=>w("đã khóa","mở khóa","ACTIVE",{tab:s.code,keySearch:t.body.keySearch})},null,8,["disabled","onClick"]),[[T,s.code!=="ACTIVE"]]),v(n(c,{label:"Khóa",class:"p-button-danger",disabled:y("ACTIVE"),onClick:e=>w("hoạt động","khóa","LOCKED",{tab:s.code,keySearch:t.body.keySearch})},null,8,["disabled","onClick"]),[[T,s.code!=="LOCKED"]])]),n(b,{class:"w-20rem"},{default:i(()=>[n(m,{modelValue:t.body.keySearch,"onUpdate:modelValue":o[0]||(o[0]=e=>t.body.keySearch=e),placeholder:"Tìm theo tên tài khoản",size:"small",class:"w-full",maxLength:"35",onKeypress:Q(e=>f(s.code,t.body.keySearch),["enter"])},null,8,["modelValue","onKeypress"]),n(c,{icon:"pi pi-search",class:W({"p-disabled":!t.body.keySearch}),onClick:e=>f(s.code,t.body.keySearch)},null,8,["class","onClick"])]),_:2},1024)])]),empty:i(()=>[ae]),default:i(()=>[n(r,{selectionMode:"multiple",class:"max-w-5rem w-5rem"}),n(r,{field:"image",header:"Ảnh thông báo",class:"white-space-nowrap",style:{width:"7rem"}},{body:i(({data:e})=>[d("img",{style:{"object-fit":"contain"},class:"w-4rem h-4rem",src:e.image||"/images/image-product-default.svg",onerror:"this.onerror=null; this.src='/images/image-product-default.svg';"},null,8,ne)]),_:1}),n(r,{field:"title",header:"Tiêu đề",headerClass:"white-space-nowrap",bodyClass:"line-height-3",style:{width:"13rem"},sortable:!0}),n(r,{field:"createdAt",header:"Thời gian gửi",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:i(({data:e})=>[d("span",null,x(S(X)(e==null?void 0:e.createdAt,!0)),1)]),_:1}),n(r,{field:"sendType",header:"Đối tượng",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),n(r,{field:"isNewNotification",header:"Người dùng đã xem",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:i(({data:e})=>[d("span",null,x(e.isNewNotification?"Chưa xem":"Đã xem"),1)]),_:1}),n(r,{field:"status",header:"Trạng thái",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:i(({data:e})=>[n(V,{code:e==null?void 0:e.status},null,8,["code"])]),_:1})]),_:2},1032,["selection","value","first","rows"])]),_:2},1032,["header"])),64))]),_:1},8,["activeIndex"])]),n(K,{class:"line-height-3"})],64)}}};export{ie as default};
