import{u as M,ap as T,r as y,c as b,b as R,o as t,d as p,e as o,F as j,h as O,M as w,g as a,L as _,t as S,n as V,H as k,z as $,K as E,x as L,X as z,a1 as I,f as B,aq as K,a as N,C as q}from"./index-d6a7eb74.js";const G={class:"w-full flex flex-column h-full"},F={key:1,class:"flex justify-content-center align-items-center text-center line-height-3"},H={class:"flex flex-column gap-3 align-items-center"},P=["src"],X={class:"text-center line-height-2"},J={key:0,class:"h-4rem"},Q={style:{bottom:"1.8rem","z-index":"999"},class:"fixed left-0 right-0 px-3 bg-white pt-2"},W={style:{"max-width":"50rem"},class:"p-3 border-round-3xl box-shadow-1 flex bg-white m-auto flex-1"},Y=["placeholder","onKeypress"],Z={style:{"padding-left":"0.7rem"},class:"border-left-1 text-400"},ee={key:0,class:"pi pi-spin pi-spinner text-900"},te={__name:"BotVersatileTypeText",props:{botVersatile:{type:Object,required:!0}},setup(g){const f=g,m=M(),{onGetterMessages:e,onActionSendMessage:l}=T(),s=y(""),n=y(!1),u=b(()=>f.botVersatile),v=b(()=>m.params.id),r=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},1)},i=async()=>{if(n.value||e.value.length&&e.value[e.value.length-1].role==="user")return;e.value.push({role:"user",content:s.value,createdAt:z(new Date,!0)}),r(),s.value="",setTimeout(()=>{n.value=!0,r()},1e3);const d=await l({botVersatileId:v.value,messages:e.value.map(({role:c,content:x})=>({role:c,content:x}))});d.success?(e.value.push(d.data.result),I.emit("isNewData","Dữ liệu mới")):e.value=[],n.value=!1,r(),setTimeout(()=>{n.value=!1},300)};return(d,c)=>{var A,U,C;const x=R("UserChat");return t(),p("div",G,[o("div",{style:{"max-width":"52rem"},class:V(["flex flex-1 flex-column gap-3 m-auto w-full pt-3",{"px-3":!a(k),"justify-content-center":!a(e).length}])},[(t(!0),p(j,null,O(a(e),(h,D)=>(t(),w(x,{key:D,name:h.role,content:h.content,role:h.role,createdAt:h.createdAt},null,8,["name","content","role","createdAt"]))),128)),n.value?(t(),w(x,{key:0,role:"assistant"})):_("",!0),a(e).length?_("",!0):(t(),p("div",F,[o("div",H,[o("img",{class:"w-10rem h-10rem object-fit-cover border-circle",src:(A=u.value)==null?void 0:A.image,onerror:"this.onerror=null; this.src='/images/image-product-default.svg';"},null,8,P),o("span",X,S((U=u.value)==null?void 0:U.message),1)])]))],2),a(k)?_("",!0):(t(),p("div",J)),o("div",Q,[o("div",W,[$(o("input",{"onUpdate:modelValue":c[0]||(c[0]=h=>s.value=h),type:"text",class:"w-full border-none outline-none",placeholder:(C=u.value)==null?void 0:C.placeholder,onKeypress:L(i,["enter"])},null,40,Y),[[E,s.value]]),o("div",Z,[n.value?(t(),p("i",ee)):(t(),p("i",{key:1,class:V(["pi pi-angle-right text-900 on-click",{"p-disabled":!s.value}]),onClick:i},null,2))])])])])}}},se={class:"w-full flex flex-column h-full"},oe=["src"],ae={__name:"BotVersatileTypeAudio",props:{botVersatile:{type:Object,required:!0}},setup(g){const f=g;T();const m=y(null),e=y(!1);let l=null,s=[];const n=b(()=>f.botVersatile),u=async()=>{try{const r=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(r),s=[],l.ondataavailable=i=>{i.data.size>0&&s.push(i.data)},l.onstop=()=>{const i=new Blob(s,{type:"audio/wav"});K(i).then(c=>{console.log(c)});const d=URL.createObjectURL(i);m.value.src=d},l.start(),e.value=!0}catch(r){console.error("Lỗi khi truy cập microphone: ",r)}},v=()=>{l&&e.value&&(l.stop(),e.value=!1)};return(r,i)=>{var c;const d=R("Button");return t(),p("div",se,[o("div",{style:{"max-width":"52rem"},class:V(["flex flex-1 flex-column gap-3 m-auto w-full pt-3 align-items-center justify-content-center",{"px-3":!a(k)}])},[o("img",{src:(c=n.value)==null?void 0:c.image,onerror:"this.onerror=null; this.src='/images/image-product-default.svg';",class:"w-10rem h-10rem object-fit-cover"},null,8,oe),o("audio",{ref_key:"audioPlayer",ref:m,controls:""},null,512),B(d,{label:"Bắt đầu",onClick:u}),B(d,{label:"Dừng lại",severity:"danger",onClick:v})],2)])}}},le={class:"relative flex flex-column h-full"},re={__name:"BotVersatile",setup(g){const f=M(),m=N(),{onGetterBotVersatile:e,onActionGetVersatile:l}=T(),s=b(()=>f.params.id);return q(async()=>{l(s.value)}),(n,u)=>{const v=R("ButtonBack");return t(),p("div",le,[B(v,{onOnBack:u[0]||(u[0]=r=>a(m).push({name:"Application"}))}),a(e).type==="TEXT"?(t(),w(te,{key:0,botVersatile:a(e)},null,8,["botVersatile"])):_("",!0),a(e).type==="AUDIO"?(t(),w(ae,{key:1,botVersatile:a(e)},null,8,["botVersatile"])):_("",!0)])}}};export{re as default};
