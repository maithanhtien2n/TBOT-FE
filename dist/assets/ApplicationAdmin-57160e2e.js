import{r as X,l as q,y as R,b as d,o as _,d as S,f as e,w as h,e as i,t as B,g as A,a3 as z,z as L,A as $,F as K,Z as Q,$ as Z,aa as J,c as W,C as Y,N as ee,h as ne,M as te,L as ae,x as oe,n as se}from"./index-ea4656f6.js";import{c as P,a as T,u as le,b as ie,_ as F}from"./InputTextValidate-1be94492.js";import{a as re,_ as ce}from"./DropdownValidate-699a7fd5.js";const de={key:0,class:"flex align-items-center gap-2"},ue={class:"text-2xl"},me={key:1,class:"text-2xl"},he={class:"flex flex-column gap-3"},pe={class:"flex flex-column gap-2"},ge=i("span",null,"Nội dung",-1),be={class:"flex flex-column gap-1"},fe={class:"flex justify-content-end gap-2"},ye={__name:"ApplicationAdminDialog",props:{value:{type:Object,required:!1,default:null}},emits:["onOpen","onCancel","onSave"],setup(C,{emit:f}){const V=C,l=X(!1),b=q({image:null,name:"",type:"TEXT",content:"",message:"",placeholder:""}),O=P({image:P().required("Vui lòng nhập ảnh"),name:T().required("Vui lòng nhập tên ứng dụng"),type:T().required("Vui lòng chọn loại phản hồi"),content:T().required("Vui lòng nhập nội dung đào tạo"),message:T().required("Vui lòng nhập thông điệp"),placeholder:T().required("Vui lòng nhập gợi ý nhập")}),{values:w,resetForm:x,setFieldValue:n,handleSubmit:E}=le({initialValues:b,validationSchema:O,keepValuesOnUnmount:!0}),{value:u,errorMessage:y}=ie("content"),I=E(async()=>{f("onSave",w),l.value=!1}),D=()=>{f("onOpen"),l.value=!0};return R(()=>V.value,p=>{p?l.value=!0:l.value=!1}),R(l,p=>{if(!p)f("onCancel");else{const o=V.value;o?(x({values:o,errors:null}),o.image&&n("image",{name:o==null?void 0:o.image.split("$")[1],base64:o==null?void 0:o.image})):x({values:{type:"TEXT"},errors:null})}}),(p,o)=>{const k=d("Button"),s=d("StatusComponent"),t=d("Textarea"),r=d("Dialog");return _(),S(K,null,[e(k,{label:"Thêm bản dự thảo",onClick:D}),e(r,{visible:l.value,"onUpdate:visible":o[2]||(o[2]=m=>l.value=m),modal:"",class:"w-30rem"},{header:h(()=>{var m,v;return[C.value?(_(),S("div",de,[i("span",ue,B((m=C.value)==null?void 0:m.name),1),i("div",null,[e(s,{code:(v=C.value)==null?void 0:v.status},null,8,["code"])])])):(_(),S("div",me,"Thêm bản dự thảo"))]}),footer:h(()=>[i("div",fe,[e(k,{type:"button",label:"Hủy bỏ",severity:"secondary",onClick:o[1]||(o[1]=m=>l.value=!1)}),e(k,{type:"button",label:"Hoàn thành",onClick:A(I)},null,8,["onClick"])])]),default:h(()=>[i("div",he,[e(re,{label:"Ảnh",name:"image",class:"image w-7rem h-7rem"}),e(F,{label:"Tên ứng dụng",name:"name",class:"w-full"}),e(ce,{label:"Loại phản hồi",name:"type",options:[{name:"Văn bản",code:"TEXT"},{name:"Âm thanh",code:"AUDIO"},{name:"Video",code:"VIDEO"}]}),e(F,{label:"Thông diệp",name:"message",class:"w-full"}),e(F,{label:"Gợi ý nhập",name:"placeholder",class:"w-full"}),i("div",pe,[ge,i("div",be,[e(t,{modelValue:A(u),"onUpdate:modelValue":o[0]||(o[0]=m=>z(u)?u.value=m:null),rows:"3",class:"w-full line-height-2"},null,8,["modelValue"]),L(i("small",{class:"p-error"},B(A(y)),513),[[$,A(y)]])])])])]),_:1},8,["visible"])],64)}}},ve={class:"flex flex-column gap-3"},_e={class:"flex flex-wrap gap-2 justify-content-between"},Ce={class:"flex gap-2"},we=["src"],ke={class:"fixed-text"},Te=i("div",{class:"flex justify-content-center"}," Không tìm thấy kết quả nào ",-1),De={__name:"ApplicationAdmin",setup(C){const f=Q(),V=Z(),{onGetterListBotVersatile:l,onActionGetListBotVersatile:b,onActionSaveBotVersatile:O,onActionUpdateStatusBotVersatile:w}=J(),x=[{name:"Tất cả",code:"ALL"},{name:"Dự thảo",code:"DRAFT"},{name:"Đang hoạt động",code:"ACTIVE"},{name:"Đã khóa",code:"LOCKED"}],n=q({tabIndex:0,body:{pagination:{first:0,rows:5,sort:null},keySearch:""},topUpNumber:null,tableSelection:[],rowValue:null}),E=W(()=>{switch(n.tabIndex){case 0:return l.value.all;case 1:return l.value.draft;case 2:return l.value.active;case 3:return l.value.locked;default:return l.value.all}}),u=s=>n.tableSelection.map(t=>t[s]),y=s=>!u("status").includes(s),I=()=>{n.body.keySearch="",n.tableSelection=[]},D=(s,t)=>{t&&b({tab:s,keySearch:t})},p=(s,t,r,{tab:m,keySearch:v})=>{if(r==="DRAFT"){if(u("status").includes("ACTIVE")||u("status").includes("LOCKED")){f.error("Vui lòng chỉ chọn dòng dữ liệu có trạng thái: "+s);return}}else if(u("status").includes(r)||u("status").includes("DRAFT")){f.error("Vui lòng chỉ chọn dòng dữ liệu có trạng thái: "+s);return}V.require({message:`Bạn muốn ${t} ứng dụng?`,header:"Xác nhận",acceptLabel:"Đồng ý",acceptClass:["LOCKED"].includes(r)?"p-button-danger":"",rejectLabel:"Hủy bỏ",rejectClass:"p-button-outlined",accept:async()=>{switch(r){case"DRAFT":await w({ids:u("_id"),status:"ACTIVE"});break;case"ACTIVE":await w({ids:u("_id"),status:"ACTIVE"});break;case"LOCKED":await w({ids:u("_id"),status:"LOCKED"});break}b({tab:m,keySearch:v},!0),n.tableSelection=[]}})},o=s=>{n.rowValue=s.data},k=async(s,{tab:t,keySearch:r})=>{(await O(s)).success&&(b({tab:t,keySearch:r},!0),n.rowValue=null)};return R(()=>n.body.keySearch,s=>{s||b({tab:"ALL",keySearch:""},!0)}),Y(()=>{b({tab:"ALL",keySearch:""})}),(s,t)=>{const r=d("Button"),m=d("InputText"),v=d("InputGroup"),g=d("Column"),U=d("StatusComponent"),N=d("DataTable"),j=d("TabPanel"),M=d("TabView"),G=d("ConfirmDialog");return _(),S(K,null,[i("div",ve,[e(ee,{icon:"pi pi-user",title:"Quản lý tài khoản"}),e(M,{activeIndex:n.tabIndex,"onUpdate:activeIndex":t[5]||(t[5]=c=>n.tabIndex=c),onTabChange:I,class:"card"},{default:h(()=>[(_(),S(K,null,ne(x,(c,H)=>e(j,{key:H,header:c.name},{default:h(()=>[e(N,{paginator:!0,selection:n.tableSelection,"onUpdate:selection":t[3]||(t[3]=a=>n.tableSelection=a),value:E.value,first:n.body.pagination.first,rows:n.body.pagination.rows,rowsPerPageOptions:[5,10,15,20],removableSort:!0,onRowDblclick:t[4]||(t[4]=a=>o(a)),paginatorTemplate:" FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Hiển thị {first} - {last} / tổng {totalRecords} dòng"},{header:h(()=>[i("div",_e,[i("div",Ce,[["DRAFT"].includes(c.code)?(_(),te(ye,{key:0,value:n.rowValue,onOnOpen:t[0]||(t[0]=a=>n.rowValue=null),onOnCancel:t[1]||(t[1]=a=>n.rowValue=null),onOnSave:a=>k(a,{tab:c.code,keySearch:n.body.keySearch})},null,8,["value","onOnSave"])):ae("",!0),L(e(r,{label:"Mở khóa",disabled:y("LOCKED"),onClick:a=>p("đã khóa","mở khóa","ACTIVE",{tab:c.code,keySearch:n.body.keySearch})},null,8,["disabled","onClick"]),[[$,!["ACTIVE","DRAFT"].includes(c.code)]]),L(e(r,{label:"Kích hoạt",severity:"secondary",disabled:y("DRAFT"),onClick:a=>p("dự thảo","kích hoạt","DRAFT",{tab:c.code,keySearch:n.body.keySearch})},null,8,["disabled","onClick"]),[[$,["ALL","DRAFT"].includes(c.code)]]),L(e(r,{label:"Khóa",class:"p-button-danger",disabled:y("ACTIVE"),onClick:a=>p("hoạt động","khóa","LOCKED",{tab:c.code,keySearch:n.body.keySearch})},null,8,["disabled","onClick"]),[[$,!["LOCKED","DRAFT"].includes(c.code)]])]),e(v,{class:"w-20rem"},{default:h(()=>[e(m,{modelValue:n.body.keySearch,"onUpdate:modelValue":t[2]||(t[2]=a=>n.body.keySearch=a),placeholder:"Tìm theo tên tài khoản",size:"small",class:"w-full",maxLength:"35",onKeypress:oe(a=>D(c.code,n.body.keySearch),["enter"])},null,8,["modelValue","onKeypress"]),e(r,{icon:"pi pi-search",class:se({"p-disabled":!n.body.keySearch}),onClick:a=>D(c.code,n.body.keySearch)},null,8,["class","onClick"])]),_:2},1024)])]),empty:h(()=>[Te]),default:h(()=>[e(g,{selectionMode:"multiple",class:"max-w-3rem w-3rem"}),e(g,{field:"image",header:"Ảnh biểu tượng",headerClass:"white-space-nowrap",style:{width:"7rem"}},{body:h(({data:a})=>[i("img",{class:"w-4rem h-4rem object-fit-cover box-shadow-1",src:a.image||"/images/image-product-default.svg",onerror:"this.onerror=null; this.src='/images/image-product-default.svg';"},null,8,we)]),_:1}),e(g,{field:"name",header:"Tên ứng dụng",headerClass:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),e(g,{field:"type",header:"Loại phản hồi",headerClass:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),e(g,{field:"content",header:"Nội dung đào tạo",bodyClass:"line-height-2",style:{width:"17rem"},sortable:!0},{body:h(({data:a})=>[i("span",ke,B(a.content),1)]),_:1}),e(g,{field:"message",header:"Thông điệp",headerClass:"white-space-nowrap",bodyClass:"line-height-2",style:{width:"7rem"},sortable:!0}),e(g,{field:"placeholder",header:"Gợi ý nhập",headerClass:"white-space-nowrap",bodyClass:"line-height-2",style:{width:"7rem"},sortable:!0}),e(g,{field:"status",header:"Trạng thái",headerClass:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:h(({data:a})=>[e(U,{code:a==null?void 0:a.status},null,8,["code"])]),_:1})]),_:2},1032,["selection","value","first","rows"])]),_:2},1032,["header"])),64))]),_:1},8,["activeIndex"])]),e(G)],64)}}};export{De as default};
