import{Z as G,$ as R,a0 as z,l as F,c as X,y as q,C as Q,b as i,d as C,e as d,f as a,w as r,F as A,o as g,N as W,h as Z,z as f,A as k,x as J,n as Y,t as w,g as N,X as S,W as ee,M as ne,a1 as te}from"./index-3106e3ea.js";const ae={class:"flex flex-column gap-3"},oe={class:"flex flex-wrap gap-2 justify-content-between"},se={class:"flex gap-2"},le=["src"],re=d("div",{class:"flex justify-content-center"}," Không tìm thấy kết quả nào ",-1),ce={key:1},ue={__name:"Account",setup(ie){const U=G(),L=R(),{onGetterListUser:h,onActionGetListUser:u,onActionUpdateMoneyBalanceUser:O,onActionUpdateStatusUser:x,onActionDeleteAccount:D}=z(),E=[{name:"Tất cả",code:"ALL"},{name:"Đang hoạt động",code:"ACTIVE"},{name:"Đã khóa",code:"LOCKED"},{name:"Chưa xác thực",code:"NO_AUTH"}],e=F({tabIndex:0,body:{pagination:{first:0,rows:5,sort:null},keySearch:""},topUpNumber:null,tableSelection:[]}),P=X(()=>{switch(e.tabIndex){case 0:return h.value.all;case 1:return h.value.active;case 2:return h.value.locked;case 3:return h.value.noAuth;default:return h.value.all}}),p=c=>e.tableSelection.map(o=>o[c]),_=c=>!p("status").includes(c),V=c=>{switch(c){case"male":return"Nam";case"female":return"Nữ";case"other":return"Khác";default:return""}},I=()=>{e.body.keySearch="",e.tableSelection=[]},v=(c,o)=>{o&&u({tab:c,keySearch:o})},y=(c,o,s,{tab:m,keySearch:b})=>{if(p("status").includes(["TOPUP","DELETE"].includes(s)?"LOCKED":s)){U.error("Vui lòng chỉ chọn dòng dữ liệu có trạng thái: "+c);return}L.require({message:`Bạn muốn ${o} tài khoản?`,header:s==="TOPUP"?"Nhập số tiền cần nạp":"Xác nhận",acceptLabel:s==="TOPUP"?"Nạp tiền":"Đồng ý",acceptClass:["LOCKED","DELETE"].includes(s)?"p-button-danger":"",rejectLabel:"Hủy bỏ",rejectClass:"p-button-outlined",type:s,accept:async()=>{s==="TOPUP"?(await O({ids:p("_id"),moneyNumber:e.topUpNumber})).success&&(await u({tab:m,keySearch:b},!0),te.emit("isNewData","Dữ liệu mới"),e.topUpNumber=null,e.tableSelection=[]):s==="DELETE"?(await D(p("_id"))).success&&(await u({tab:m,keySearch:b},!0),e.tableSelection=[]):(await x({ids:p("_id"),status:s})).success&&(await u({tab:m,keySearch:b},!0),e.tableSelection=[])}})};return q(()=>e.body.keySearch,c=>{c||u({tab:"ALL",keySearch:""},!0)}),Q(()=>{u({tab:"ALL",keySearch:""})}),(c,o)=>{const s=i("Button"),m=i("InputText"),b=i("InputGroup"),l=i("Column"),H=i("StatusComponent"),K=i("DataTable"),B=i("TabPanel"),$=i("TabView"),M=i("InputNumber"),j=i("ConfirmDialog");return g(),C(A,null,[d("div",ae,[a(W,{icon:"pi pi-user",title:"Quản lý tài khoản"}),a($,{activeIndex:e.tabIndex,"onUpdate:activeIndex":o[2]||(o[2]=n=>e.tabIndex=n),onTabChange:I,class:"card"},{default:r(()=>[(g(),C(A,null,Z(E,(n,T)=>a(B,{key:T,header:n.name},{default:r(()=>[a(K,{paginator:!0,selection:e.tableSelection,"onUpdate:selection":o[1]||(o[1]=t=>e.tableSelection=t),value:P.value,first:e.body.pagination.first,rows:e.body.pagination.rows,rowsPerPageOptions:[5,10,15,20],removableSort:!0,paginatorTemplate:" FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Hiển thị {first} - {last} / tổng {totalRecords} dòng"},{header:r(()=>[d("div",oe,[d("div",se,[f(a(s,{label:"Mở khóa",disabled:_("LOCKED"),onClick:t=>y("đã khóa","mở khóa","ACTIVE",{tab:n.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[k,n.code!=="ACTIVE"&&n.code!=="NO_AUTH"]]),f(a(s,{label:"Khóa",class:"p-button-danger",disabled:_("ACTIVE"),onClick:t=>y("hoạt động","khóa","LOCKED",{tab:n.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[k,n.code!=="LOCKED"&&n.code!=="NO_AUTH"]]),f(a(s,{label:"Nạp tiền",severity:"secondary",disabled:_("ACTIVE"),onClick:t=>y("hoạt động","nạp tiền","TOPUP",{tab:n.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[k,n.code!=="LOCKED"&&n.code!=="NO_AUTH"]]),f(a(s,{label:"Xóa tài khoản",class:"p-button-danger",disabled:_("NO_AUTH"),onClick:t=>y("hoạt động","xóa","DELETE",{tab:n.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[k,n.code==="NO_AUTH"]])]),a(b,{class:"w-20rem"},{default:r(()=>[a(m,{modelValue:e.body.keySearch,"onUpdate:modelValue":o[0]||(o[0]=t=>e.body.keySearch=t),placeholder:"Tìm theo tên tài khoản",size:"small",class:"w-full",maxLength:"35",onKeypress:J(t=>v(n.code,e.body.keySearch),["enter"])},null,8,["modelValue","onKeypress"]),a(s,{icon:"pi pi-search",class:Y({"p-disabled":!e.body.keySearch}),onClick:t=>v(n.code,e.body.keySearch)},null,8,["class","onClick"])]),_:2},1024)])]),empty:r(()=>[re]),default:r(()=>[a(l,{selectionMode:"multiple",class:"max-w-5rem w-5rem"}),a(l,{field:"email",header:"Tên tài khoản",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),a(l,{field:"avatar",header:"Ảnh đại diện",class:"white-space-nowrap",style:{width:"7rem"},hidden:n.code==="NO_AUTH"},{body:r(({data:t})=>[d("img",{class:"w-4rem h-4rem object-fit-cover box-shadow-1",src:t.avatar||"/images/avatar.jpg",onerror:"this.onerror=null; this.src='/images/avatar.jpg';"},null,8,le)]),_:2},1032,["hidden"]),a(l,{field:"fullName",header:"Họ và tên",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code==="NO_AUTH"},null,8,["hidden"]),a(l,{field:"phoneNumber",header:"Số điện thoại",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code==="NO_AUTH"},null,8,["hidden"]),a(l,{field:"gender",header:"Giới tính",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code==="NO_AUTH"},{body:r(({data:t})=>[d("span",null,w(V(t.gender)),1)]),_:2},1032,["hidden"]),a(l,{field:"otp",header:"Mã xác thực",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code!=="NO_AUTH"},null,8,["hidden"]),a(l,{field:"createdAt",header:"Ngày đăng ký",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code!=="NO_AUTH"},{body:r(({data:t})=>[d("span",null,w(N(S)(t==null?void 0:t.createdAt,!0)),1)]),_:2},1032,["hidden"]),a(l,{field:"updatedAt",header:"Ngày đăng ký gần nhất",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code!=="NO_AUTH"},{body:r(({data:t})=>[d("span",null,w(N(S)(t==null?void 0:t.updatedAt,!0)),1)]),_:2},1032,["hidden"]),a(l,{field:"moneyBalance",header:"Số dư",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0,hidden:n.code==="NO_AUTH"},{body:r(({data:t})=>[d("span",null,w(N(ee)(t.moneyBalance)),1)]),_:2},1032,["hidden"]),a(l,{field:"status",header:"Trạng thái",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:r(({data:t})=>[a(H,{code:t==null?void 0:t.status},null,8,["code"])]),_:1})]),_:2},1032,["selection","value","first","rows"])]),_:2},1032,["header"])),64))]),_:1},8,["activeIndex"])]),a(j,null,{message:r(n=>[n.message.type==="TOPUP"?(g(),ne(M,{key:0,modelValue:e.topUpNumber,"onUpdate:modelValue":o[3]||(o[3]=T=>e.topUpNumber=T),class:"w-full",currency:"VND",locale:"vn-VN"},null,8,["modelValue"])):(g(),C("span",ce,w(n.message.message),1))]),_:1})],64)}}};export{ue as default};
